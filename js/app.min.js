var myApp=new Framework7({uniqueHistory:true,animatePages:true,swipeBackPage:true,swipeBackPageThreshold:100,swipeBackPageActiveArea:500,swipeBackPageAnimateShadow:false,swipeBackPageAnimateOpacity:false,hideNavbarOnPageScroll:true,hideToolbarOnPageScroll:true,showBarsOnPageScrollEnd:true,precompileTemplates:false,swipeBackPageAnimateShadow:false,swipeBackPageAnimateOpacity:false});var $=Dom7;var longitude="116.404",latitude="39.915",city="北京市";function initMap(){plus.geolocation.getCurrentPosition(function(a){longitude=a.coords.longitude;latitude=a.coords.latitude;city=a.address.city;baiduMap(longitude,latitude,city)},function(a){alert("Geolocation error: "+a.message)},{provider:"baidu"})}function baiduMap(a,k,e){var c=new BMap.Map("map");var l=new BMap.Point(a,k);c.centerAndZoom(l,15);var g=new BMap.Marker(l);c.addOverlay(g);var n=new BMap.ScaleControl({anchor:BMAP_ANCHOR_BOTTOM_RIGHT});var m=new BMap.NavigationControl({anchor:BMAP_ANCHOR_BOTTOM_RIGHT,type:BMAP_NAVIGATION_CONTROL_SMALL});c.addControl(n);c.addControl(m);var d=new BMap.MapTypeControl({mapTypes:[BMAP_NORMAL_MAP,BMAP_HYBRID_MAP]});c.addControl(d);var f=JSON.parse(localStorage.getItem("mapsearch"));if(f){var h=f.radius;var i=f.fenlei;var b=new BMap.Circle(l,h,{fillColor:"blue",strokeWeight:1,fillOpacity:0.1,strokeOpacity:0.3});c.addOverlay(b);var j=new BMap.LocalSearch(c,{renderOptions:{map:c,autoViewport:false}});j.searchNearby(i,l,h);localStorage.removeItem("mapsearch");$("#index-dingwei").click(function(){c.centerAndZoom(l,15)})}}function baiduMapShebei(b){b=JSON.parse(b);var e=b.longitude;var h=b.latitude;var a=b.shebei;var f=new BMap.Map("map");var g=new BMap.Point(e,h);f.centerAndZoom(g,15);f.enableScrollWheelZoom();var d=null;d=new BMapLib.SearchInfoWindow(f,"",{title:a,enableAutoPan:true,searchTypes:[BMAPLIB_TAB_SEARCH,BMAPLIB_TAB_TO_HERE,BMAPLIB_TAB_FROM_HERE]});var c=new BMap.Marker(g);d.open(c);f.addOverlay(c)}var mainView=myApp.addView(".view-main",{dynamicNavbar:true,});function indexPageInit(){$("#index-search").click(function(){mainView.router.loadPage("fujin.html")});var b=$(window).height()-90;$("#map").css("height",b+"px");var a=localStorage.getItem("shebeisearch");localStorage.removeItem("shebeisearch");if(a){baiduMapShebei(a)}else{if(window.plus){initMap()}else{document.addEventListener("plusready",initMap,false)}}var c=localStorage.getItem("denglu");if(!c){myApp.popup(".login-screen")}$(".login-screen").find(".login").on("click",function(){var e=$(".login-screen").find('input[name="username"]').val();var d=$(".login-screen").find('input[name="password"]').val();if(e==""){myApp.toast("账号不能为空","",{}).show();return false}if(d==""){myApp.toast("密码不能为空","",{}).show();return false}localStorage.setItem("denglu","true");localStorage.setItem("user",e);myApp.closeModal(".login-screen")});toast=myApp.toast("轻语一现","",{});$("#btnshow").click(function(){toast.show()})}indexPageInit();myApp.onPageInit("index",function(a){indexPageInit()});myApp.onPageBeforeInit("shebei",function(){});myApp.onPageInit("shebei",function(a){$(".create-page").on("click",function(){createContentPage()});if(!a.query.id){return}});myApp.onPageBack("shebei",function(a){});myApp.onPageInit("fujin",function(a){$("#fujin .col-20").on("click",function(){if($(this).attr("data-shebei")){alert("要跟后台要列表");return}var b=$("#fujin").find(".radius").val();b=(isNaN(parseInt(b))?500:b);var c=$(this).find(".icon-name").text();var d={fenlei:c,radius:b};localStorage.setItem("mapsearch",JSON.stringify(d));mainView.router.loadPage("index.html")});if(!a.query.id){return}});myApp.onPageInit("mubanluru",function(c){var b=[{"电梯":["自动扶梯与自动人行道监督检验","曳引驱动电梯定期检验"]},{"起重机":["桥门式起重机和门式起重机定期检验","机械式起重机定期检验"]},{"压力容器":["年度压力容器定期检验","压力容器定期检验"]},{"锅炉":["工业锅炉内部定期检验","工业锅炉外部定期检验"]},{"厂内机动车":["厂内机动车监督检验原始记录"]}];a("电梯");$("#lei").change(function(){a($(this).val())});function a(l){var h="",g="";for(var f=0;f<b.length;f++){for(var e in b[f]){if(l==e){h+='<option selected="selected">'+e+"</option>";for(var d=0;d<b[f][e].length;d++){g+="<option>"+b[f][e][d]+"</option>"}}else{h+="<option>"+e+"</option>"}}$("#lei").html(h);$("#zilei").html(g)}}});myApp.onPageInit("baogaoluru",function(b){$(window).on("click","#baogaoluru .ditu",function(){var d=$(this).attr("data-jing");var f=$(this).attr("data-wei");var c=$(this).attr("data-shebei");var e={longitude:d,latitude:f,shebei:c};localStorage.setItem("shebeisearch",JSON.stringify(e));mainView.router.loadPage("index.html")});var a=localStorage.getItem("user");$.post("http://125.93.93.173:8044/Gis/List?user=lzh",function(d){var e=JSON.parse(d);if(e){var c=template("baogaoluru-tem",e);$("#baogaoluru-list").html(c)}})});myApp.onPageInit("shangchuanbaogao",function(a){$("#shangchuanbaogao .ditu").click(function(){var c=$(this).attr("data-jing");var e=$(this).attr("data-wei");var b=$(this).attr("data-shebei");var d={longitude:c,latitude:e,shebei:b};localStorage.setItem("shebeisearch",JSON.stringify(d));mainView.router.loadPage("index.html")})});